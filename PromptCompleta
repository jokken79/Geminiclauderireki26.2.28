# MEGA-PROMPT: Sistema Integral de Gesti√≥n HR para Empresa de Staffing Japonesa (‰∫∫ÊùêÊ¥æÈÅ£‰ºöÁ§æ)

---

## CONTEXTO Y OBJETIVO

Construir desde cero una aplicaci√≥n web moderna y completa para una empresa de staffing/‰∫∫ÊùêÊ¥æÈÅ£‰ºöÁ§æ en Jap√≥n. El sistema gestiona el **ciclo de vida completo** de trabajadores temporales: desde candidato hasta empleado activo (Ê¥æÈÅ£Á§æÂì° o Ë´ãË≤†).

### M√≥dulos del Sistema

1. **Rirekisho (Â±•Ê≠¥Êõ∏)** ‚Äî Curr√≠culum japon√©s con 50+ campos y foto 3x4cm
2. **Candidatos (ÂÄôË£úËÄÖ)** ‚Äî Registro, entrevista, aprobaci√≥n/rechazo
3. **ÂÖ•Á§æÂ±ä„Åë (Nyusha Todoke)** ‚Äî Formulario de ingreso laboral (candidato aprobado ‚Üí empleado)
4. **Ê¥æÈÅ£Á§æÂì° (Haken Shain)** ‚Äî Trabajadores despachados a f√°bricas/empresas cliente
5. **Ë´ãË≤† (Ukeoi)** ‚Äî Trabajadores por contrato/subcontrataci√≥n
6. **F√°bricas/Empresas Cliente (Ê¥æÈÅ£ÂÖà/Â∑•Â†¥)** ‚Äî Gesti√≥n de empresas destino
7. **Documentos** ‚Äî Gesti√≥n de documentos (Âú®Áïô„Ç´„Éº„Éâ, pasaporte, licencias)
8. **OCR e IA** ‚Äî Escaneo autom√°tico de rirekisho con Azure OCR + AI
9. **Importaci√≥n de Fotos** ‚Äî Upload, almacenamiento y sincronizaci√≥n de fotos entre entidades
10. **RBAC** ‚Äî Control de acceso basado en roles con jerarqu√≠a
11. **Auditor√≠a** ‚Äî Audit trail completo de todas las operaciones
12. **Importaci√≥n/Exportaci√≥n** ‚Äî CSV, Excel, datos masivos

### Lo que NO incluye este sistema

- ~~Timecards / „Çø„Ç§„É†„Ç´„Éº„Éâ~~ (no implementar)
- ~~N√≥minas / Áµ¶‰∏éË®àÁÆó~~ (no implementar)
- ~~Apartamentos / Á§æÂÆÖÁÆ°ÁêÜ~~ (no implementar)
- ~~C√°lculos de renta / ÂÆ∂Ë≥ÉÊéßÈô§~~ (no implementar)

---

## STACK TECNOL√ìGICO RECOMENDADO

### Frontend
```
- Next.js 16+ (App Router) ‚Äî Framework React con SSR/SSG
- React 19 ‚Äî √öltima versi√≥n estable
- TypeScript 5.6+ ‚Äî Tipado estricto
- Tailwind CSS 3.4+ ‚Äî Utility-first CSS
- Radix UI ‚Äî Componentes UI accesibles y sin estilos
- shadcn/ui ‚Äî Componentes pre-estilizados sobre Radix
- React Hook Form v7+ + Zod v3+ ‚Äî Formularios con validaci√≥n tipada
- TanStack Query v5 ‚Äî Data fetching, caching, sincronizaci√≥n
- TanStack Table ‚Äî Tablas con sorting, filtering, pagination
- Zustand v5 ‚Äî Estado global ligero
- Recharts ‚Äî Gr√°ficos y visualizaci√≥n
- Framer Motion ‚Äî Animaciones fluidas
- react-easy-crop ‚Äî Recorte de fotos (formato 3x4cm japon√©s)
- Lucide React ‚Äî Iconos
- Vitest ‚Äî Unit tests
- Playwright ‚Äî E2E tests
```

### Backend
```
- FastAPI 0.115+ ‚Äî Framework Python de alto rendimiento
- Python 3.11+ ‚Äî Async nativo
- SQLAlchemy 2.0+ ‚Äî ORM con soporte async
- Alembic ‚Äî Migraciones de base de datos
- PostgreSQL 16+ ‚Äî Base de datos con UTF-8 completo para japon√©s
- Redis 7+ ‚Äî Cache y sesiones
- JWT (HS256) + CSRF (Double-Submit Cookie) ‚Äî Autenticaci√≥n segura
- Loguru ‚Äî Logging estructurado
- pytest + pytest-asyncio ‚Äî Testing
- black, isort, mypy, flake8, bandit ‚Äî Linting y seguridad
- Pillow ‚Äî Procesamiento de im√°genes
```

### Base de Datos
```
- PostgreSQL 16+ con encoding UTF-8, locale ja_JP.UTF-8
- Collation japon√©s para ordenamiento correcto de nombres en kana/kanji
- √çndices GIN para b√∫squeda full-text en japon√©s
- pg_trgm para b√∫squeda por similitud en kana/kanji
- JSONB para datos semi-estructurados (formularios OCR, employee_data)
```

### Infraestructura
```
- Docker + Docker Compose ‚Äî 12+ servicios orquestados
- Nginx ‚Äî Reverse proxy con health checks
- OpenTelemetry ‚Äî Telemetr√≠a distribuida
- Prometheus + Grafana ‚Äî M√©tricas y dashboards
- GitHub Actions ‚Äî CI/CD multi-stage
```

---

## MODELOS DE DATOS COMPLETOS

### 1. USER („É¶„Éº„Ç∂„Éº) ‚Äî Sistema de Usuarios

```
Modelo: User
‚îú‚îÄ‚îÄ id (Integer, PK, auto)
‚îú‚îÄ‚îÄ username (String[50], unique, NOT NULL) ‚Äî „É¶„Éº„Ç∂„ÉºÂêç
‚îú‚îÄ‚îÄ email (String[100], unique, NOT NULL) ‚Äî „É°„Éº„É´„Ç¢„Éâ„É¨„Çπ
‚îú‚îÄ‚îÄ password_hash (String[255], NOT NULL) ‚Äî BCrypt hash
‚îú‚îÄ‚îÄ role (Enum: UserRole, NOT NULL, default=EMPLOYEE)
‚îú‚îÄ‚îÄ full_name (String[100]) ‚Äî Ë°®Á§∫Âêç
‚îú‚îÄ‚îÄ is_active (Boolean, default=true)
‚îú‚îÄ‚îÄ created_at (DateTime, auto)
‚îî‚îÄ‚îÄ updated_at (DateTime, auto)

UserRole (Enum - JERARQU√çA):
‚îú‚îÄ‚îÄ SUPER_ADMIN ‚Äî Acceso total al sistema
‚îú‚îÄ‚îÄ ADMIN ‚Äî Administraci√≥n general
‚îú‚îÄ‚îÄ KEITOSAN ‚Äî ÁµåÁêÜÁÆ°ÁêÜ (Finance/Accounting)
‚îú‚îÄ‚îÄ TANTOSHA ‚Äî ÊãÖÂΩìËÄÖ (HR/Operations)
‚îú‚îÄ‚îÄ COORDINATOR ‚Äî Coordinador
‚îú‚îÄ‚îÄ KANRININSHA ‚Äî ÁÆ°ÁêÜ‰∫∫ËÄÖ (Office/HR personnel)
‚îú‚îÄ‚îÄ EMPLOYEE ‚Äî Ê¥æÈÅ£ÂÖÉÁ§æÂì° (Dispatch workers) - acceso limitado
‚îî‚îÄ‚îÄ CONTRACT_WORKER ‚Äî Ë´ãË≤† (Contract workers) - acceso limitado
```

---

### 2. CANDIDATE (ÂÄôË£úËÄÖ) ‚Äî Candidato/Rirekisho Completo

Este es el modelo central. Contiene TODOS los campos del rirekisho japon√©s (50+ campos).

```
Modelo: Candidate (SoftDelete)
‚îú‚îÄ‚îÄ id (Integer, PK, auto)
‚îú‚îÄ‚îÄ rirekisho_id (String[20], unique, NOT NULL) ‚Äî Â±•Ê≠¥Êõ∏ID (ej: "RK-2025-001")
‚îú‚îÄ‚îÄ applicant_id (String[50]) ‚Äî ÂøúÂãüËÄÖID (ID de formulario)
‚îÇ
‚îú‚îÄ‚îÄ ===== FECHAS DE RECEPCI√ìN =====
‚îú‚îÄ‚îÄ reception_date (Date) ‚Äî Âèó‰ªòÊó• (fecha de recepci√≥n del rirekisho)
‚îú‚îÄ‚îÄ arrival_date (Date) ‚Äî Êù•Êó• (fecha de llegada a Jap√≥n)
‚îÇ
‚îú‚îÄ‚îÄ ===== INFORMACI√ìN B√ÅSICA (Âü∫Êú¨ÊÉÖÂ†±) =====
‚îú‚îÄ‚îÄ full_name_kanji (String[100]) ‚Äî Ê∞èÂêç (nombre completo en kanji)
‚îú‚îÄ‚îÄ full_name_kana (String[100]) ‚Äî „Éï„É™„Ç¨„Éä (nombre en katakana)
‚îú‚îÄ‚îÄ full_name_roman (String[100]) ‚Äî Ê∞èÂêç„É≠„Éº„ÉûÂ≠ó (nombre en romaji)
‚îú‚îÄ‚îÄ gender (String[10]) ‚Äî ÊÄßÂà• (masculino/femenino)
‚îú‚îÄ‚îÄ date_of_birth (Date) ‚Äî ÁîüÂπ¥ÊúàÊó•
‚îú‚îÄ‚îÄ nationality (String[50]) ‚Äî ÂõΩÁ±ç
‚îú‚îÄ‚îÄ marital_status (String[20]) ‚Äî ÈÖçÂÅ∂ËÄÖ (estado civil)
‚îú‚îÄ‚îÄ hire_date (Date) ‚Äî ÂÖ•Á§æÊó• (se llena al ser contratado)
‚îÇ
‚îú‚îÄ‚îÄ ===== FOTO (ÂÜôÁúü) =====
‚îú‚îÄ‚îÄ photo_url (String[255]) ‚Äî URL de la foto
‚îú‚îÄ‚îÄ photo_data_url (Text) ‚Äî Base64 data URL de la foto de carnet (3x4cm)
‚îÇ   ‚òÖ La foto se almacena como data:image/jpeg;base64,...
‚îÇ   ‚òÖ Se COPIA (no referencia) al crear Employee
‚îÇ
‚îú‚îÄ‚îÄ ===== DIRECCI√ìN (‰ΩèÊâÄ) =====
‚îú‚îÄ‚îÄ postal_code (String[10]) ‚Äî ÈÉµ‰æøÁï™Âè∑ (formato: XXX-XXXX)
‚îú‚îÄ‚îÄ current_address (Text) ‚Äî Áèæ‰ΩèÊâÄ
‚îú‚îÄ‚îÄ address (Text) ‚Äî ‰ΩèÊâÄ (principal)
‚îú‚îÄ‚îÄ address_banchi (String[100]) ‚Äî Áï™Âú∞ (bloque/lote)
‚îú‚îÄ‚îÄ address_building (String[100]) ‚Äî Áâ©‰ª∂Âêç (edificio/apartamento)
‚îú‚îÄ‚îÄ registered_address (Text) ‚Äî ÁôªÈå≤‰ΩèÊâÄ (direcci√≥n registrada)
‚îÇ
‚îú‚îÄ‚îÄ ===== CONTACTO (ÈÄ£Áµ°ÂÖà) =====
‚îú‚îÄ‚îÄ phone (String[20]) ‚Äî ÈõªË©±Áï™Âè∑
‚îú‚îÄ‚îÄ mobile (String[20]) ‚Äî Êê∫Â∏ØÈõªË©±
‚îú‚îÄ‚îÄ email (String[100]) ‚Äî „É°„Éº„É´„Ç¢„Éâ„É¨„Çπ
‚îÇ
‚îú‚îÄ‚îÄ ===== PASAPORTE („Éë„Çπ„Éù„Éº„Éà) =====
‚îú‚îÄ‚îÄ passport_number (String[50]) ‚Äî „Éë„Çπ„Éù„Éº„ÉàÁï™Âè∑
‚îú‚îÄ‚îÄ passport_expiry (Date) ‚Äî „Éë„Çπ„Éù„Éº„ÉàÊúüÈôê
‚îÇ
‚îú‚îÄ‚îÄ ===== Âú®Áïô„Ç´„Éº„Éâ (RESIDENCE CARD) =====
‚îú‚îÄ‚îÄ residence_status (String[50]) ‚Äî Âú®ÁïôË≥áÊ†º (tipo de visa)
‚îú‚îÄ‚îÄ residence_expiry (Date) ‚Äî Âú®ÁïôÊúüÈôê
‚îú‚îÄ‚îÄ residence_card_number (String[50]) ‚Äî Âú®Áïô„Ç´„Éº„ÉâÁï™Âè∑
‚îÇ
‚îú‚îÄ‚îÄ ===== ÈÅãËª¢ÂÖçË®± (DRIVER'S LICENSE) =====
‚îú‚îÄ‚îÄ license_number (String[50]) ‚Äî ÈÅãËª¢ÂÖçË®±Áï™Âè∑Âèä„Å≥Êù°‰ª∂
‚îú‚îÄ‚îÄ license_expiry (Date) ‚Äî ÈÅãËª¢ÂÖçË®±ÊúüÈôê
‚îú‚îÄ‚îÄ car_ownership (String[10]) ‚Äî Ëá™ÂãïËªäÊâÄÊúâ („ÅÇ„Çä/„Å™„Åó)
‚îú‚îÄ‚îÄ voluntary_insurance (String[10]) ‚Äî ‰ªªÊÑè‰øùÈô∫Âä†ÂÖ• („ÅÇ„Çä/„Å™„Åó)
‚îÇ
‚îú‚îÄ‚îÄ ===== Ë≥áÊ†º„ÉªÂÖçË®± (QUALIFICATIONS) =====
‚îú‚îÄ‚îÄ forklift_license (String[10]) ‚Äî „Éï„Ç©„Éº„ÇØ„É™„Éï„ÉàÂÖçË®±
‚îú‚îÄ‚îÄ tama_kake (String[10]) ‚Äî ÁéâÊéõ
‚îú‚îÄ‚îÄ mobile_crane_under_5t (String[10]) ‚Äî ÁßªÂãïÂºè„ÇØ„É¨„Éº„É≥ÈÅãËª¢Â£´(5„Éà„É≥Êú™Ê∫Ä)
‚îú‚îÄ‚îÄ mobile_crane_over_5t (String[10]) ‚Äî ÁßªÂãïÂºè„ÇØ„É¨„Éº„É≥ÈÅãËª¢Â£´(5„Éà„É≥‰ª•‰∏ä)
‚îú‚îÄ‚îÄ gas_welding (String[10]) ‚Äî „Ç¨„ÇπÊ∫∂Êé•‰ΩúÊ•≠ËÄÖ
‚îú‚îÄ‚îÄ qualification_1 (String[100]) ‚Äî ÊúâË≥áÊ†ºÂèñÂæó1
‚îú‚îÄ‚îÄ qualification_2 (String[100]) ‚Äî ÊúâË≥áÊ†ºÂèñÂæó2
‚îú‚îÄ‚îÄ qualification_3 (String[100]) ‚Äî ÊúâË≥áÊ†ºÂèñÂæó3
‚îÇ
‚îú‚îÄ‚îÄ ===== ÂÆ∂ÊóèÊßãÊàê (FAMILY MEMBERS) ‚Äî Hasta 5 miembros =====
‚îú‚îÄ‚îÄ family_name_N (String[100]) ‚Äî Ê∞èÂêçN (N=1..5)
‚îú‚îÄ‚îÄ family_relation_N (String[50]) ‚Äî Á∂öÊüÑN
‚îú‚îÄ‚îÄ family_age_N (Integer) ‚Äî Âπ¥ÈΩ¢N
‚îú‚îÄ‚îÄ family_residence_N (String[50]) ‚Äî Â±Ö‰ΩèN
‚îú‚îÄ‚îÄ family_separate_address_N (Text) ‚Äî Âà•Â±Ö‰Ωè‰ΩèÊâÄN
‚îú‚îÄ‚îÄ family_dependent_N (String[50]) ‚Äî Êâ∂È§äN
‚îÇ
‚îú‚îÄ‚îÄ ===== ËÅ∑Ê≠¥ (WORK HISTORY) =====
‚îú‚îÄ‚îÄ work_history_company_7 (String[200])
‚îú‚îÄ‚îÄ work_history_entry_company_7 (String[200])
‚îú‚îÄ‚îÄ work_history_exit_company_7 (String[200])
‚îÇ
‚îú‚îÄ‚îÄ ===== ÁµåÈ®ì‰ΩúÊ•≠ (WORK EXPERIENCE) ‚Äî Checkboxes =====
‚îú‚îÄ‚îÄ exp_nc_lathe (Boolean) ‚Äî NCÊóãÁõ§
‚îú‚îÄ‚îÄ exp_lathe (Boolean) ‚Äî ÊóãÁõ§
‚îú‚îÄ‚îÄ exp_press (Boolean) ‚Äî „Éó„É¨„Çπ
‚îú‚îÄ‚îÄ exp_forklift (Boolean) ‚Äî „Éï„Ç©„Éº„ÇØ„É™„Éï„Éà
‚îú‚îÄ‚îÄ exp_packing (Boolean) ‚Äî Ê¢±ÂåÖ
‚îú‚îÄ‚îÄ exp_welding (Boolean) ‚Äî Ê∫∂Êé•
‚îú‚îÄ‚îÄ exp_car_assembly (Boolean) ‚Äî ËªäÈÉ®ÂìÅÁµÑÁ´ã
‚îú‚îÄ‚îÄ exp_car_line (Boolean) ‚Äî ËªäÈÉ®ÂìÅ„É©„Ç§„É≥
‚îú‚îÄ‚îÄ exp_car_inspection (Boolean) ‚Äî ËªäÈÉ®ÂìÅÊ§úÊüª
‚îú‚îÄ‚îÄ exp_electronic_inspection (Boolean) ‚Äî ÈõªÂ≠êÈÉ®ÂìÅÊ§úÊüª
‚îú‚îÄ‚îÄ exp_food_processing (Boolean) ‚Äî È£üÂìÅÂä†Â∑•
‚îú‚îÄ‚îÄ exp_casting (Boolean) ‚Äî Èã≥ÈÄ†
‚îú‚îÄ‚îÄ exp_line_leader (Boolean) ‚Äî „É©„Ç§„É≥„É™„Éº„ÉÄ„Éº
‚îú‚îÄ‚îÄ exp_painting (Boolean) ‚Äî Â°óË£Ö
‚îú‚îÄ‚îÄ exp_other (Text) ‚Äî „Åù„ÅÆ‰ªñ
‚îÇ
‚îú‚îÄ‚îÄ ===== „ÅäÂºÅÂΩì (LUNCH OPTIONS) =====
‚îú‚îÄ‚îÄ bento_lunch_dinner (String[10]) ‚Äî Êòº/Â§ú
‚îú‚îÄ‚îÄ bento_lunch_only (String[10]) ‚Äî Êòº„ÅÆ„Åø
‚îú‚îÄ‚îÄ bento_dinner_only (String[10]) ‚Äî Â§ú„ÅÆ„Åø
‚îú‚îÄ‚îÄ bento_bring_own (String[10]) ‚Äî ÊåÅÂèÇ
‚îú‚îÄ‚îÄ lunch_preference (String[50]) ‚Äî Á§æÂÜÖÈ£üÂ†Ç
‚îÇ
‚îú‚îÄ‚îÄ ===== ÈÄöÂã§ (COMMUTE) =====
‚îú‚îÄ‚îÄ commute_method (String[50]) ‚Äî ÈÄöÂã§ÊñπÊ≥ï (carro, bicicleta, tren, etc.)
‚îú‚îÄ‚îÄ commute_time_oneway (Integer) ‚Äî ÈÄöÂã§ÁâáÈÅìÊôÇÈñì (minutos)
‚îÇ
‚îú‚îÄ‚îÄ ===== Èù¢Êé•„ÉªÊ§úÊüª (INTERVIEW & TESTS) =====
‚îú‚îÄ‚îÄ interview_result (Enum: InterviewResult) ‚Äî Èù¢Êé•ÁµêÊûú
‚îÇ   ‚îú‚îÄ‚îÄ PASSED ‚Äî üëç ÂêàÊ†º
‚îÇ   ‚îú‚îÄ‚îÄ FAILED ‚Äî üëé ‰∏çÂêàÊ†º
‚îÇ   ‚îî‚îÄ‚îÄ PENDING ‚Äî ‚è≥ ‰øùÁïô
‚îú‚îÄ‚îÄ antigen_test_kit (String[20]) ‚Äî Á∞°ÊòìÊäóÂéüÊ§úÊüª„Ç≠„ÉÉ„Éà
‚îú‚îÄ‚îÄ antigen_test_date (Date) ‚Äî Á∞°ÊòìÊäóÂéüÊ§úÊüªÂÆüÊñΩÊó•
‚îú‚îÄ‚îÄ covid_vaccine_status (String[50]) ‚Äî „Ç≥„É≠„Éä„ÉØ„ÇØ„ÉÅ„É≥‰∫àÈò≤Êé•Á®ÆÁä∂ÊÖã
‚îÇ
‚îú‚îÄ‚îÄ ===== Ë™ûÂ≠¶ (LANGUAGE SKILLS) =====
‚îú‚îÄ‚îÄ language_skill_exists (String[10]) ‚Äî Ë™ûÂ≠¶„Çπ„Ç≠„É´ÊúâÁÑ°
‚îú‚îÄ‚îÄ language_skill_1 (String[100]) ‚Äî Ë™ûÂ≠¶„Çπ„Ç≠„É´1
‚îú‚îÄ‚îÄ language_skill_2 (String[100]) ‚Äî Ë™ûÂ≠¶„Çπ„Ç≠„É´2
‚îÇ
‚îú‚îÄ‚îÄ ===== Êó•Êú¨Ë™ûËÉΩÂäõ (JAPANESE LANGUAGE ABILITY) =====
‚îú‚îÄ‚îÄ japanese_qualification (String[50]) ‚Äî Êó•Êú¨Ë™ûËÉΩÂäõË≥áÊ†º
‚îú‚îÄ‚îÄ japanese_level (String[10]) ‚Äî Êó•Êú¨Ë™ûËÉΩÂäõ„É¨„Éô„É´ (N1-N5)
‚îú‚îÄ‚îÄ jlpt_taken (String[10]) ‚Äî ËÉΩÂäõË©¶È®ìÂèóÈ®ìÊúâÁÑ°
‚îú‚îÄ‚îÄ jlpt_date (Date) ‚Äî ËÉΩÂäõË©¶È®ìÂèóÈ®ìÊó•‰ªò
‚îú‚îÄ‚îÄ jlpt_score (Integer) ‚Äî ËÉΩÂäõË©¶È®ìÁÇπÊï∞
‚îú‚îÄ‚îÄ jlpt_scheduled (String[30]) ‚Äî ÂèóÈ®ì‰∫àÂÆö
‚îÇ
‚îú‚îÄ‚îÄ ===== Â≠¶Ê≠¥ (EDUCATION) =====
‚îú‚îÄ‚îÄ major (String[100]) ‚Äî Â∞ÇÊîª
‚îÇ
‚îú‚îÄ‚îÄ ===== Ë∫´‰ΩìÊÉÖÂ†± (PHYSICAL INFO) =====
‚îú‚îÄ‚îÄ height (Float) ‚Äî Ë∫´Èï∑(cm)
‚îú‚îÄ‚îÄ weight (Float) ‚Äî ‰ΩìÈáç(kg)
‚îú‚îÄ‚îÄ clothing_size (String[10]) ‚Äî Êúç„ÅÆ„Çµ„Ç§„Ç∫ (S/M/L/XL/XXL)
‚îú‚îÄ‚îÄ waist (Integer) ‚Äî „Ç¶„Ç®„Çπ„Éà(cm)
‚îú‚îÄ‚îÄ shoe_size (Float) ‚Äî Èù¥„Çµ„Ç§„Ç∫(cm)
‚îú‚îÄ‚îÄ blood_type (String[5]) ‚Äî Ë°ÄÊ∂≤Âûã (A/B/O/AB)
‚îú‚îÄ‚îÄ vision_right (Float) ‚Äî Ë¶ñÂäõ(Âè≥)
‚îú‚îÄ‚îÄ vision_left (Float) ‚Äî Ë¶ñÂäõ(Â∑¶)
‚îú‚îÄ‚îÄ dominant_hand (String[10]) ‚Äî Âà©„ÅçËÖï (Âè≥/Â∑¶/‰∏°Êñπ)
‚îú‚îÄ‚îÄ allergy_exists (String[10]) ‚Äî „Ç¢„É¨„É´„ÇÆ„ÉºÊúâÁÑ°
‚îú‚îÄ‚îÄ glasses (String[100]) ‚Äî „É°„Ç¨„Éç„Éª„Ç≥„É≥„Çø„ÇØ„Éà‰ΩøÁî®
‚îÇ
‚îú‚îÄ‚îÄ ===== Ë™≠„ÅøÊõ∏„ÅçËÉΩÂäõ (READING & WRITING) =====
‚îú‚îÄ‚îÄ listening_level (String[20]) ‚Äî ËÅû„Åè
‚îú‚îÄ‚îÄ speaking_level (String[20]) ‚Äî Ë©±„Åô
‚îú‚îÄ‚îÄ read_katakana (String[20]) ‚Äî Ë™≠„ÇÄ „Ç´„Çø„Ç´„Éä
‚îú‚îÄ‚îÄ read_hiragana (String[20]) ‚Äî Ë™≠„ÇÄ „Å≤„Çâ„Åå„Å™
‚îú‚îÄ‚îÄ read_kanji (String[20]) ‚Äî Ë™≠„ÇÄ Êº¢Â≠ó
‚îú‚îÄ‚îÄ write_katakana (String[20]) ‚Äî Êõ∏„Åè „Ç´„Çø„Ç´„Éä
‚îú‚îÄ‚îÄ write_hiragana (String[20]) ‚Äî Êõ∏„Åè „Å≤„Çâ„Åå„Å™
‚îú‚îÄ‚îÄ write_kanji (String[20]) ‚Äî Êõ∏„Åè Êº¢Â≠ó
‚îú‚îÄ‚îÄ can_speak (String[20]) ‚Äî ‰ºöË©±„Åå„Åß„Åç„Çã
‚îú‚îÄ‚îÄ can_understand (String[20]) ‚Äî ‰ºöË©±„ÅåÁêÜËß£„Åß„Åç„Çã
‚îú‚îÄ‚îÄ can_read_kana (String[20]) ‚Äî „Å≤„Çâ„Åå„Å™„Éª„Ç´„Çø„Ç´„ÉäË™≠„ÇÅ„Çã
‚îú‚îÄ‚îÄ can_write_kana (String[20]) ‚Äî „Å≤„Çâ„Åå„Å™„Éª„Ç´„Çø„Ç´„ÉäÊõ∏„Åë„Çã
‚îÇ
‚îú‚îÄ‚îÄ ===== Á∑äÊÄ•ÈÄ£Áµ°ÂÖà (EMERGENCY CONTACT) =====
‚îú‚îÄ‚îÄ emergency_contact_name (String[100]) ‚Äî Á∑äÊÄ•ÈÄ£Áµ°ÂÖà Ê∞èÂêç
‚îú‚îÄ‚îÄ emergency_contact_relation (String[50]) ‚Äî Á∑äÊÄ•ÈÄ£Áµ°ÂÖà Á∂öÊüÑ
‚îú‚îÄ‚îÄ emergency_contact_phone (String[20]) ‚Äî Á∑äÊÄ•ÈÄ£Áµ°ÂÖà ÈõªË©±Áï™Âè∑
‚îÇ
‚îú‚îÄ‚îÄ ===== ‰ΩúÊ•≠Áî®ÂìÅ (WORK EQUIPMENT) =====
‚îú‚îÄ‚îÄ safety_shoes (String[10]) ‚Äî ÂÆâÂÖ®Èù¥
‚îÇ
‚îú‚îÄ‚îÄ ===== OCR =====
‚îú‚îÄ‚îÄ ocr_notes (Text) ‚Äî OCRÂá¶ÁêÜ„É°„É¢ (notas del procesamiento OCR)
‚îÇ
‚îú‚îÄ‚îÄ ===== STATUS & AUDIT =====
‚îú‚îÄ‚îÄ status (String[20], default="pending")
‚îÇ   CandidateStatus (Enum):
‚îÇ   ‚îú‚îÄ‚îÄ PENDING ‚Äî ‰øùÁïô‰∏≠ (esperando revisi√≥n)
‚îÇ   ‚îú‚îÄ‚îÄ APPROVED ‚Äî ÊâøË™çÊ∏à (aprobado, listo para ÂÖ•Á§æÂ±ä„Åë)
‚îÇ   ‚îú‚îÄ‚îÄ REJECTED ‚Äî Âç¥‰∏ã (rechazado)
‚îÇ   ‚îî‚îÄ‚îÄ HIRED ‚Äî Êé°Áî®Ê∏à (ya es empleado)
‚îú‚îÄ‚îÄ approved_by (FK ‚Üí User) ‚Äî Qui√©n aprob√≥
‚îú‚îÄ‚îÄ approved_at (DateTime) ‚Äî Cu√°ndo fue aprobado
‚îú‚îÄ‚îÄ created_at (DateTime, auto)
‚îú‚îÄ‚îÄ updated_at (DateTime, auto)
‚îÇ
‚îî‚îÄ‚îÄ Relaciones:
    ‚îú‚îÄ‚îÄ documents ‚Üí Document[] (1:N) ‚Äî Documentos adjuntos
    ‚îú‚îÄ‚îÄ form_submissions ‚Üí CandidateForm[] (1:N) ‚Äî Snapshots JSON de formularios
    ‚îú‚îÄ‚îÄ employees ‚Üí Employee[] (1:N via rirekisho_id) ‚Äî Empleados creados
    ‚îî‚îÄ‚îÄ requests ‚Üí Request[] (1:N) ‚Äî Solicitudes (ÂÖ•Á§æÈÄ£Áµ°Á•®, etc.)
```

---

### 3. CANDIDATE FORM (ÂÄôË£úËÄÖ„Éï„Ç©„Éº„É†) ‚Äî Snapshots de Formularios

```
Modelo: CandidateForm
‚îú‚îÄ‚îÄ id (Integer, PK)
‚îú‚îÄ‚îÄ candidate_id (FK ‚Üí Candidate, nullable)
‚îú‚îÄ‚îÄ rirekisho_id (String[20])
‚îú‚îÄ‚îÄ applicant_id (String[50])
‚îú‚îÄ‚îÄ form_data (JSON, NOT NULL) ‚Äî Snapshot completo del formulario
‚îú‚îÄ‚îÄ photo_data_url (Text) ‚Äî Foto Base64 del momento del env√≠o
‚îú‚îÄ‚îÄ azure_metadata (JSON) ‚Äî Metadata del procesamiento OCR de Azure
‚îú‚îÄ‚îÄ created_at (DateTime)
‚îî‚îÄ‚îÄ updated_at (DateTime)

‚òÖ Prop√≥sito: Guardar versiones crudas de formularios antes del procesamiento.
  √ötil para auditor√≠a y para corregir errores de OCR.
```

---

### 4. FACTORY (Â∑•Â†¥/Ê¥æÈÅ£ÂÖà) ‚Äî F√°bricas y Empresas Cliente

```
Modelo: Factory (SoftDelete)
‚îú‚îÄ‚îÄ id (Integer, PK)
‚îú‚îÄ‚îÄ factory_id (String[200], unique, NOT NULL) ‚Äî ID compuesto: "CompanyName__PlantName"
‚îú‚îÄ‚îÄ company_name (String[100]) ‚Äî ‰ºÅÊ•≠Âêç (ej: "„Éà„É®„ÇøËá™ÂãïËªä")
‚îú‚îÄ‚îÄ plant_name (String[100]) ‚Äî Â∑•Â†¥Âêç (ej: "Â≤°Â±±Â∑•Â†¥")
‚îú‚îÄ‚îÄ name (String[100], NOT NULL) ‚Äî Nombre completo display
‚îú‚îÄ‚îÄ address (Text) ‚Äî ÊâÄÂú®Âú∞
‚îú‚îÄ‚îÄ phone (String[20]) ‚Äî ÈõªË©±Áï™Âè∑
‚îú‚îÄ‚îÄ contact_person (String[100]) ‚Äî ÊãÖÂΩìËÄÖÂêç
‚îú‚îÄ‚îÄ config (JSON) ‚Äî Configuraci√≥n espec√≠fica de la f√°brica
‚îú‚îÄ‚îÄ is_active (Boolean, default=true)
‚îú‚îÄ‚îÄ created_at (DateTime)
‚îî‚îÄ‚îÄ updated_at (DateTime)

Relaciones:
‚îú‚îÄ‚îÄ employees ‚Üí Employee[] ‚Äî Empleados (Ê¥æÈÅ£Á§æÂì°) asignados
‚îî‚îÄ‚îÄ contract_workers ‚Üí ContractWorker[] ‚Äî Trabajadores por contrato (Ë´ãË≤†)

‚òÖ El factory_id compuesto "Company__Plant" permite que una empresa
  tenga m√∫ltiples plantas/f√°bricas.
```

---

### 5. EMPLOYEE BASE MIXIN ‚Äî Campos Compartidos (Ê¥æÈÅ£Á§æÂì° y Ë´ãË≤†)

```
Mixin: EmployeeBaseMixin (~60 campos compartidos)
‚îú‚îÄ‚îÄ id (Integer, PK)
‚îú‚îÄ‚îÄ hakenmoto_id (Integer, unique, NOT NULL) ‚Äî ID interno auto-generado
‚îú‚îÄ‚îÄ rirekisho_id (String[20], FK ‚Üí Candidate.rirekisho_id)
‚îú‚îÄ‚îÄ factory_id (String[200], FK ‚Üí Factory.factory_id)
‚îú‚îÄ‚îÄ company_name (String[100]) ‚Äî ‰ºÅÊ•≠Âêç (denormalizado)
‚îú‚îÄ‚îÄ plant_name (String[100]) ‚Äî Â∑•Â†¥Âêç (denormalizado)
‚îú‚îÄ‚îÄ hakensaki_shain_id (String[50]) ‚Äî ID de trabajador en empresa destino
‚îÇ
‚îú‚îÄ‚îÄ ===== INFORMACI√ìN PERSONAL =====
‚îú‚îÄ‚îÄ full_name_kanji (String[100], NOT NULL) ‚Äî Ê∞èÂêç
‚îú‚îÄ‚îÄ full_name_kana (String[100]) ‚Äî „Éï„É™„Ç¨„Éä
‚îú‚îÄ‚îÄ photo_url (String[255])
‚îú‚îÄ‚îÄ photo_data_url (Text) ‚Äî Base64 sincronizado desde Candidate
‚îú‚îÄ‚îÄ date_of_birth (Date) ‚Äî ÁîüÂπ¥ÊúàÊó•
‚îú‚îÄ‚îÄ gender (String[10]) ‚Äî ÊÄßÂà•
‚îú‚îÄ‚îÄ nationality (String[50]) ‚Äî ÂõΩÁ±ç
‚îú‚îÄ‚îÄ zairyu_card_number (String[50]) ‚Äî Âú®Áïô„Ç´„Éº„ÉâÁï™Âè∑
‚îú‚îÄ‚îÄ zairyu_expire_date (Date) ‚Äî Âú®ÁïôÊúüÈôê
‚îÇ
‚îú‚îÄ‚îÄ ===== CONTACTO =====
‚îú‚îÄ‚îÄ address (Text) ‚Äî ‰ΩèÊâÄ
‚îú‚îÄ‚îÄ phone (String[20])
‚îú‚îÄ‚îÄ email (String[100])
‚îú‚îÄ‚îÄ emergency_contact_name (String[100]) ‚Äî Á∑äÊÄ•ÈÄ£Áµ°ÂÖàÊ∞èÂêç
‚îú‚îÄ‚îÄ emergency_contact_phone (String[20])
‚îú‚îÄ‚îÄ emergency_contact_relationship (String[50])
‚îÇ
‚îú‚îÄ‚îÄ ===== EMPLEO (ÈõáÁî®ÊÉÖÂ†±) =====
‚îú‚îÄ‚îÄ hire_date (Date) ‚Äî ÂÖ•Á§æÊó•
‚îú‚îÄ‚îÄ current_hire_date (Date) ‚Äî ÁèæÂÖ•Á§æ (fecha de entrada a f√°brica actual)
‚îú‚îÄ‚îÄ jikyu (Integer) ‚Äî ÊôÇÁµ¶ (salario por hora en yen)
‚îú‚îÄ‚îÄ jikyu_revision_date (Date) ‚Äî ÊôÇÁµ¶ÊîπÂÆö (fecha revisi√≥n salarial)
‚îú‚îÄ‚îÄ position (String[100]) ‚Äî ÂΩπËÅ∑
‚îú‚îÄ‚îÄ contract_type (String[50]) ‚Äî Â•ëÁ¥ÑÁ®ÆÈ°û
‚îÇ
‚îú‚îÄ‚îÄ ===== ASIGNACI√ìN (ÈÖçÂ±û) =====
‚îú‚îÄ‚îÄ assignment_location (String[200]) ‚Äî ÈÖçÂ±ûÂÖà
‚îú‚îÄ‚îÄ assignment_line (String[200]) ‚Äî ÈÖçÂ±û„É©„Ç§„É≥ (l√≠nea de producci√≥n)
‚îú‚îÄ‚îÄ job_description (Text) ‚Äî ‰ªï‰∫ãÂÜÖÂÆπ
‚îÇ
‚îú‚îÄ‚îÄ ===== INFORMACI√ìN FINANCIERA =====
‚îú‚îÄ‚îÄ hourly_rate_charged (Integer) ‚Äî Ë´ãÊ±ÇÂçò‰æ° (tarifa cobrada al cliente)
‚îú‚îÄ‚îÄ billing_revision_date (Date) ‚Äî Ë´ãÊ±ÇÊîπÂÆö
‚îú‚îÄ‚îÄ profit_difference (Integer) ‚Äî Â∑ÆÈ°çÂà©Áõä (diferencia de ganancia)
‚îú‚îÄ‚îÄ standard_compensation (Integer) ‚Äî Ê®ôÊ∫ñÂ†±ÈÖ¨
‚îú‚îÄ‚îÄ health_insurance (Integer) ‚Äî ÂÅ•Â∫∑‰øùÈô∫
‚îú‚îÄ‚îÄ nursing_insurance (Integer) ‚Äî ‰ªãË≠∑‰øùÈô∫
‚îú‚îÄ‚îÄ pension_insurance (Integer) ‚Äî ÂéöÁîüÂπ¥Èáë
‚îú‚îÄ‚îÄ social_insurance_date (Date) ‚Äî Á§æ‰øùÂä†ÂÖ•Êó•
‚îÇ
‚îú‚îÄ‚îÄ ===== VISA Y DOCUMENTOS =====
‚îú‚îÄ‚îÄ visa_type (String[50]) ‚Äî „Éì„Ç∂Á®ÆÈ°û
‚îú‚îÄ‚îÄ license_type (String[100]) ‚Äî ÂÖçË®±Á®ÆÈ°û
‚îú‚îÄ‚îÄ license_expire_date (Date) ‚Äî ÂÖçË®±ÊúüÈôê
‚îú‚îÄ‚îÄ commute_method (String[50]) ‚Äî ÈÄöÂã§ÊñπÊ≥ï
‚îú‚îÄ‚îÄ optional_insurance_expire (Date) ‚Äî ‰ªªÊÑè‰øùÈô∫ÊúüÈôê
‚îú‚îÄ‚îÄ japanese_level (String[50]) ‚Äî Êó•Êú¨Ë™ûÊ§úÂÆö
‚îú‚îÄ‚îÄ career_up_5years (Boolean) ‚Äî „Ç≠„É£„É™„Ç¢„Ç¢„ÉÉ„Éó5Âπ¥ÁõÆ
‚îú‚îÄ‚îÄ entry_request_date (Date) ‚Äî ÂÖ•Á§æ‰æùÈ†ºÊó•
‚îú‚îÄ‚îÄ notes (Text) ‚Äî ÂÇôËÄÉ
‚îú‚îÄ‚îÄ postal_code (String[10])
‚îÇ
‚îú‚îÄ‚îÄ ===== STATUS =====
‚îú‚îÄ‚îÄ is_active (Boolean, default=true)
‚îú‚îÄ‚îÄ termination_date (Date) ‚Äî ÈÄÄËÅ∑Êó•
‚îú‚îÄ‚îÄ termination_reason (Text) ‚Äî ÈÄÄËÅ∑ÁêÜÁî±
‚îú‚îÄ‚îÄ created_at (DateTime)
‚îî‚îÄ‚îÄ updated_at (DateTime)
```

---

### 6. EMPLOYEE (Ê¥æÈÅ£Á§æÂì°) ‚Äî Trabajadores Despachados

```
Modelo: Employee (SoftDelete, hereda EmployeeBaseMixin)
‚îú‚îÄ‚îÄ [Todos los campos del EmployeeBaseMixin]
‚îÇ
‚îú‚îÄ‚îÄ ===== CAMPOS ESPEC√çFICOS DE Ê¥æÈÅ£Á§æÂì° =====
‚îú‚îÄ‚îÄ current_address (String) ‚Äî Áèæ‰ΩèÊâÄ
‚îú‚îÄ‚îÄ address_banchi (String) ‚Äî Áï™Âú∞
‚îú‚îÄ‚îÄ address_building (String) ‚Äî Áâ©‰ª∂Âêç
‚îÇ
‚îú‚îÄ‚îÄ ===== GESTI√ìN REGIONAL =====
‚îú‚îÄ‚îÄ workplace_id (FK ‚Üí Workplace) ‚Äî ËÅ∑Â†¥ actual
‚îú‚îÄ‚îÄ current_region_id (FK ‚Üí Region) ‚Äî Regi√≥n
‚îú‚îÄ‚îÄ current_factory_id (FK ‚Üí Factory) ‚Äî F√°brica actual
‚îú‚îÄ‚îÄ current_department_id (FK ‚Üí Department) ‚Äî Departamento
‚îú‚îÄ‚îÄ residence_type_id (FK ‚Üí ResidenceType) ‚Äî Tipo de residencia
‚îú‚îÄ‚îÄ residence_status_id (FK ‚Üí ResidenceStatus) ‚Äî Estado migratorio
‚îú‚îÄ‚îÄ residence_address (Text)
‚îú‚îÄ‚îÄ residence_monthly_cost (Integer)
‚îú‚îÄ‚îÄ residence_start_date (Date)
‚îÇ
‚îú‚îÄ‚îÄ ===== VISA ALERTS =====
‚îú‚îÄ‚îÄ visa_renewal_alert (Boolean, default=false) ‚Äî „Ç¢„É©„Éº„Éà „Éì„Ç∂Êõ¥Êñ∞
‚îú‚îÄ‚îÄ visa_alert_days (Integer, default=30) ‚Äî D√≠as antes de alerta
‚îÇ
‚îú‚îÄ‚îÄ ===== ÊúâÁµ¶‰ºëÊöá (YUKYU - Paid Leave) =====
‚îú‚îÄ‚îÄ yukyu_total (Integer, default=0) ‚Äî ÊúâÁµ¶ÂêàË®à
‚îú‚îÄ‚îÄ yukyu_used (Integer, default=0) ‚Äî ‰ΩøÁî®Ê∏à
‚îú‚îÄ‚îÄ yukyu_remaining (Integer, default=0) ‚Äî ÊÆã„Çä
‚îÇ
‚îú‚îÄ‚îÄ ===== STATUS =====
‚îú‚îÄ‚îÄ current_status (String[20], default='active')
‚îÇ   ‚îú‚îÄ‚îÄ "active" ‚Äî Á®ºÂÉç‰∏≠
‚îÇ   ‚îú‚îÄ‚îÄ "terminated" ‚Äî ÈÄÄËÅ∑Ê∏à
‚îÇ   ‚îî‚îÄ‚îÄ "suspended" ‚Äî ‰ºëËÅ∑‰∏≠
‚îÇ
‚îî‚îÄ‚îÄ Relaciones:
    ‚îú‚îÄ‚îÄ candidate ‚Üí Candidate (via rirekisho_id)
    ‚îú‚îÄ‚îÄ factory ‚Üí Factory
    ‚îú‚îÄ‚îÄ workplace ‚Üí Workplace
    ‚îú‚îÄ‚îÄ documents ‚Üí Document[]
    ‚îú‚îÄ‚îÄ requests ‚Üí Request[]
    ‚îú‚îÄ‚îÄ contracts ‚Üí Contract[]
    ‚îú‚îÄ‚îÄ current_region ‚Üí Region
    ‚îú‚îÄ‚îÄ current_department ‚Üí Department
    ‚îú‚îÄ‚îÄ residence_type ‚Üí ResidenceType
    ‚îú‚îÄ‚îÄ residence_status ‚Üí ResidenceStatus
    ‚îú‚îÄ‚îÄ yukyu_balances ‚Üí YukyuBalance[]
    ‚îî‚îÄ‚îÄ yukyu_requests ‚Üí YukyuRequest[]
```

---

### 7. CONTRACT WORKER (Ë´ãË≤†Á§æÂì°) ‚Äî Trabajadores por Contrato

```
Modelo: ContractWorker (SoftDelete, hereda EmployeeBaseMixin)
‚îú‚îÄ‚îÄ [Todos los campos del EmployeeBaseMixin]
‚îÇ
‚îú‚îÄ‚îÄ ‚òÖ DIFERENCIA LEGAL CLAVE con Employee (Ê¥æÈÅ£Á§æÂì°):
‚îÇ   - En Ë´ãË≤† NO hay ÊåáÊèÆÂëΩ‰ª§Èñ¢‰øÇ (relaci√≥n de mando) con el cliente
‚îÇ   - La supervisi√≥n la hace NUESTRA empresa, no el cliente
‚îÇ   - Se cobra por resultado/proyecto, no necesariamente por hora
‚îÇ   - Si el cliente da instrucciones directas ‚Üí ÂÅΩË£ÖË´ãË≤† (ILEGAL)
‚îÇ
‚îî‚îÄ‚îÄ Relaciones:
    ‚îú‚îÄ‚îÄ factory ‚Üí Factory
    ‚îî‚îÄ‚îÄ [No tiene workplace, region, yukyu, etc.]
```

---

### 8. STAFF („Çπ„Çø„ÉÉ„Éï) ‚Äî Personal Interno de Oficina

```
Modelo: Staff (SoftDelete)
‚îú‚îÄ‚îÄ id (Integer, PK)
‚îú‚îÄ‚îÄ staff_id (Integer, unique, NOT NULL)
‚îú‚îÄ‚îÄ rirekisho_id (String[20], FK ‚Üí Candidate.rirekisho_id)
‚îÇ
‚îú‚îÄ‚îÄ full_name_kanji (String[100], NOT NULL)
‚îú‚îÄ‚îÄ full_name_kana (String[100])
‚îú‚îÄ‚îÄ photo_url / photo_data_url
‚îú‚îÄ‚îÄ date_of_birth, gender, nationality
‚îú‚îÄ‚îÄ address, phone, email
‚îú‚îÄ‚îÄ emergency_contact_*
‚îú‚îÄ‚îÄ postal_code
‚îÇ
‚îú‚îÄ‚îÄ hire_date, position, department
‚îú‚îÄ‚îÄ monthly_salary (Integer) ‚Äî Salario mensual fijo (NO por hora)
‚îÇ
‚îú‚îÄ‚îÄ Seguros sociales, yukyu, status...
‚îî‚îÄ‚îÄ is_active, termination_date, notes
```

---

### 9. REQUEST (Áî≥Ë´ã) ‚Äî Sistema de Solicitudes

```
Modelo: Request
‚îú‚îÄ‚îÄ id (Integer, PK)
‚îú‚îÄ‚îÄ hakenmoto_id (FK ‚Üí Employee.hakenmoto_id, nullable)
‚îú‚îÄ‚îÄ candidate_id (FK ‚Üí Candidate.id, nullable) ‚Äî Para ÂÖ•Á§æÈÄ£Áµ°Á•®
‚îú‚îÄ‚îÄ request_type (Enum: RequestType)
‚îÇ   ‚îú‚îÄ‚îÄ YUKYU ‚Äî ÊúâÁµ¶‰ºëÊöá (vacaciones pagadas)
‚îÇ   ‚îú‚îÄ‚îÄ HANKYU ‚Äî Âçä‰ºë (medio d√≠a)
‚îÇ   ‚îú‚îÄ‚îÄ IKKIKOKOKU ‚Äî ‰∏ÄÊôÇÂ∏∞ÂõΩ (retorno temporal al pa√≠s)
‚îÇ   ‚îú‚îÄ‚îÄ TAISHA ‚Äî ÈÄÄÁ§æ (renuncia)
‚îÇ   ‚îî‚îÄ‚îÄ NYUUSHA ‚Äî ÂÖ•Á§æÈÄ£Áµ°Á•® (formulario de ingreso laboral) ‚òÖ
‚îÇ
‚îú‚îÄ‚îÄ status (Enum: RequestStatus)
‚îÇ   ‚îú‚îÄ‚îÄ PENDING ‚Äî ‰øùÁïô‰∏≠
‚îÇ   ‚îú‚îÄ‚îÄ APPROVED ‚Äî ÊâøË™çÊ∏à
‚îÇ   ‚îú‚îÄ‚îÄ REJECTED ‚Äî Âç¥‰∏ã
‚îÇ   ‚îî‚îÄ‚îÄ COMPLETED ‚Äî Ê∏à (usado para ÂÖ•Á§æÈÄ£Áµ°Á•® despu√©s de crear empleado)
‚îÇ
‚îú‚îÄ‚îÄ start_date (Date, NOT NULL)
‚îú‚îÄ‚îÄ end_date (Date, NOT NULL)
‚îú‚îÄ‚îÄ total_days ‚Üí Computed property: (end_date - start_date + 1)
‚îú‚îÄ‚îÄ reason (Text) ‚Äî Motivo
‚îú‚îÄ‚îÄ notes (Text) ‚Äî Notas
‚îÇ
‚îú‚îÄ‚îÄ employee_data (JSONB, nullable) ‚Äî ‚òÖ Para ÂÖ•Á§æÈÄ£Áµ°Á•®: datos del empleado
‚îÇ   {
‚îÇ     "factory_id": "Company__Plant",
‚îÇ     "hire_date": "2025-11-20",
‚îÇ     "jikyu": 1500,
‚îÇ     "position": "Machine Operator",
‚îÇ     "contract_type": "Ê≠£Á§æÂì°",
‚îÇ     "is_shatak": false,
‚îÇ     "apartment_id": null,
‚îÇ     "hakensaki_shain_id": "HS-001",
‚îÇ     "bank_name": "‰∏âËè±UFJÈäÄË°å",
‚îÇ     "bank_account": "1234567890",
‚îÇ     "emergency_contact_name": "...",
‚îÇ     "emergency_contact_phone": "...",
‚îÇ     "created_by_user": "admin"
‚îÇ   }
‚îÇ
‚îú‚îÄ‚îÄ approved_by (FK ‚Üí User)
‚îú‚îÄ‚îÄ approved_at (DateTime)
‚îú‚îÄ‚îÄ created_at, updated_at
‚îÇ
‚îî‚îÄ‚îÄ Relaciones:
    ‚îú‚îÄ‚îÄ employee ‚Üí Employee (via hakenmoto_id)
    ‚îî‚îÄ‚îÄ candidate ‚Üí Candidate
```

---

### 10. DOCUMENT (Êõ∏È°û) ‚Äî Documentos Adjuntos

```
Modelo: Document
‚îú‚îÄ‚îÄ id (Integer, PK)
‚îú‚îÄ‚îÄ candidate_id (FK ‚Üí Candidate, nullable)
‚îú‚îÄ‚îÄ employee_id (FK ‚Üí Employee, nullable)
‚îú‚îÄ‚îÄ document_type (Enum: DocumentType)
‚îÇ   ‚îú‚îÄ‚îÄ RIREKISHO ‚Äî Â±•Ê≠¥Êõ∏ (curr√≠culum)
‚îÇ   ‚îú‚îÄ‚îÄ ZAIRYU_CARD ‚Äî Âú®Áïô„Ç´„Éº„Éâ (tarjeta de residencia)
‚îÇ   ‚îú‚îÄ‚îÄ LICENSE ‚Äî ÂÖçË®± (licencia)
‚îÇ   ‚îú‚îÄ‚îÄ CONTRACT ‚Äî Â•ëÁ¥ÑÊõ∏ (contrato)
‚îÇ   ‚îî‚îÄ‚îÄ OTHER ‚Äî „Åù„ÅÆ‰ªñ
‚îÇ
‚îú‚îÄ‚îÄ file_name (String[255], NOT NULL)
‚îú‚îÄ‚îÄ file_path (String[500], NOT NULL) ‚Äî Ruta al archivo
‚îú‚îÄ‚îÄ file_size (Integer) ‚Äî Tama√±o en bytes
‚îú‚îÄ‚îÄ mime_type (String[100])
‚îú‚îÄ‚îÄ ocr_data (JSON) ‚Äî Resultado del procesamiento OCR
‚îú‚îÄ‚îÄ uploaded_at (DateTime, auto)
‚îî‚îÄ‚îÄ uploaded_by (FK ‚Üí User)
```

---

### 11. CONTRACT (Â•ëÁ¥Ñ) ‚Äî Contratos de Empleo

```
Modelo: Contract (SoftDelete)
‚îú‚îÄ‚îÄ id (Integer, PK)
‚îú‚îÄ‚îÄ employee_id (FK ‚Üí Employee, NOT NULL)
‚îú‚îÄ‚îÄ contract_type (String[50], NOT NULL) ‚Äî Ê≠£Á§æÂì°/Â•ëÁ¥ÑÁ§æÂì°/„Éë„Éº„Éà
‚îú‚îÄ‚îÄ contract_number (String[50], unique) ‚Äî Â•ëÁ¥ÑÁï™Âè∑
‚îú‚îÄ‚îÄ start_date (Date, NOT NULL) ‚Äî Â•ëÁ¥ÑÈñãÂßãÊó•
‚îú‚îÄ‚îÄ end_date (Date) ‚Äî Â•ëÁ¥ÑÁµÇ‰∫ÜÊó•
‚îú‚îÄ‚îÄ pdf_path (String[500]) ‚Äî PDF del contrato generado
‚îú‚îÄ‚îÄ signed (Boolean, default=false) ‚Äî ÁΩ≤ÂêçÊ∏à„Åø
‚îú‚îÄ‚îÄ signed_at (DateTime) ‚Äî Fecha de firma
‚îú‚îÄ‚îÄ signature_data (Text) ‚Äî Firma Base64
‚îî‚îÄ‚îÄ created_at (DateTime)
```

---

### 12. MODELOS DE SOPORTE

```
Region ‚Äî Regiones geogr√°ficas (ÊÑõÁü•, ‰∏âÈáç, etc.)
Department ‚Äî Departamentos organizacionales
ResidenceType ‚Äî Tipos de residencia
ResidenceStatus ‚Äî Estados migratorios/visa (con max_duration_months)
Workplace ‚Äî Ubicaciones de trabajo (Company + Location)
SocialInsuranceRate ‚Äî Tarifas de seguros sociales por rango de compensaci√≥n
SystemSettings ‚Äî Configuraci√≥n del sistema (key-value)
PageVisibility ‚Äî Control de visibilidad de p√°ginas por rol
RolePagePermission ‚Äî Permisos de rol por p√°gina (RBAC)
AuditLog ‚Äî Log de auditor√≠a general
AdminAuditLog ‚Äî Log de auditor√≠a de administraci√≥n
```

---

## FLUJO DE TRABAJO COMPLETO ‚Äî CANDIDATO A EMPLEADO

Este es el flujo principal del sistema, paso a paso:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  FASE 1: REGISTRO DEL CANDIDATO                         ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  [PASO 1] Ingreso de Rirekisho (3 m√©todos posibles)     ‚îÇ
‚îÇ  ‚îú‚îÄ A) Formulario manual web (50+ campos)               ‚îÇ
‚îÇ  ‚îú‚îÄ B) OCR: Escanear documento con Azure OCR + AI       ‚îÇ
‚îÇ  ‚îÇ     ‚îî‚Üí Se escanea foto del rirekisho                 ‚îÇ
‚îÇ  ‚îÇ     ‚îî‚Üí Azure Computer Vision extrae texto             ‚îÇ
‚îÇ  ‚îÇ     ‚îî‚Üí AI (Gemini/OpenAI/Claude) interpreta campos   ‚îÇ
‚îÇ  ‚îÇ     ‚îî‚Üí Se muestra vista previa para correcci√≥n       ‚îÇ
‚îÇ  ‚îî‚îÄ C) Importaci√≥n masiva CSV/Excel                     ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  Resultado: Se crea registro en tabla Candidate         ‚îÇ
‚îÇ  Status inicial: PENDING (‰øùÁïô‰∏≠)                        ‚îÇ
‚îÇ  Se almacena foto como Base64 (photo_data_url)          ‚îÇ
‚îÇ  Se guarda snapshot en CandidateForm (form_data JSON)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  FASE 2: REVISI√ìN Y ENTREVISTA                          ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  [PASO 2] Revisi√≥n del candidato por admin/HR           ‚îÇ
‚îÇ  ‚îú‚îÄ Se revisan datos personales, documentos, fotos      ‚îÇ
‚îÇ  ‚îú‚îÄ Se verifica Âú®Áïô„Ç´„Éº„Éâ (tarjeta de residencia)       ‚îÇ
‚îÇ  ‚îú‚îÄ Se revisan cualificaciones y experiencia            ‚îÇ
‚îÇ  ‚îî‚îÄ Se actualiza interview_result:                      ‚îÇ
‚îÇ     ‚îú‚îÄ üëç PASSED (ÂêàÊ†º) ‚Üí Contin√∫a al PASO 3           ‚îÇ
‚îÇ     ‚îú‚îÄ üëé FAILED (‰∏çÂêàÊ†º) ‚Üí Candidato rechazado        ‚îÇ
‚îÇ     ‚îî‚îÄ ‚è≥ PENDING (‰øùÁïô) ‚Üí Pendiente de decisi√≥n        ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  [PASO 3] Decisi√≥n: Aprobar o Rechazar                  ‚îÇ
‚îÇ  ‚îú‚îÄ APROBAR: status ‚Üí APPROVED (ÊâøË™çÊ∏à)                  ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚Üí Se crea autom√°ticamente ÂÖ•Á§æÈÄ£Áµ°Á•®               ‚îÇ
‚îÇ  ‚îÇ      (Request tipo NYUUSHA, status PENDING)           ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚Üí Se vincula request.candidate_id = candidate.id  ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ
‚îÇ  ‚îî‚îÄ RECHAZAR: status ‚Üí REJECTED (Âç¥‰∏ã)                   ‚îÇ
‚îÇ     ‚îî‚Üí Se registra motivo de rechazo                     ‚îÇ
‚îÇ     ‚îî‚Üí Candidato queda inactivo                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ (Si APPROVED)
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  FASE 3: ÂÖ•Á§æÂ±ä„Åë (NYUSHA TODOKE) ‚Äî FORMULARIO DE INGRESO‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  [PASO 4] Admin llena datos de empleo                   ‚îÇ
‚îÇ  PUT /api/requests/{id}/employee-data                   ‚îÇ
‚îÇ  ‚îú‚îÄ factory_id ‚Üí ¬øA qu√© f√°brica/empresa va?            ‚îÇ
‚îÇ  ‚îú‚îÄ hire_date ‚Üí Fecha de ingreso (no puede ser pasada)  ‚îÇ
‚îÇ  ‚îú‚îÄ jikyu ‚Üí ÊôÇÁµ¶ (salario por hora: 800-5000 yen)      ‚îÇ
‚îÇ  ‚îú‚îÄ position ‚Üí Puesto de trabajo                        ‚îÇ
‚îÇ  ‚îú‚îÄ contract_type ‚Üí Ê≠£Á§æÂì°/Â•ëÁ¥ÑÁ§æÂì°/„Éë„Éº„Éà               ‚îÇ
‚îÇ  ‚îú‚îÄ hakensaki_shain_id ‚Üí ID en empresa destino          ‚îÇ
‚îÇ  ‚îú‚îÄ bank_name, bank_account ‚Üí Datos bancarios           ‚îÇ
‚îÇ  ‚îú‚îÄ emergency_contact_* ‚Üí Contacto de emergencia        ‚îÇ
‚îÇ  ‚îî‚îÄ Se almacena todo en request.employee_data (JSONB)   ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  Validaciones:                                           ‚îÇ
‚îÇ  ‚îú‚îÄ Factory debe existir en la BD                        ‚îÇ
‚îÇ  ‚îú‚îÄ hire_date no puede ser fecha pasada                  ‚îÇ
‚îÇ  ‚îú‚îÄ jikyu debe estar entre 800 y 5000 yen               ‚îÇ
‚îÇ  ‚îî‚îÄ Request debe ser tipo NYUUSHA y status PENDING       ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  [PASO 5] Aprobaci√≥n final del ÂÖ•Á§æÈÄ£Áµ°Á•®                ‚îÇ
‚îÇ  POST /api/requests/{id}/approve-nyuusha                ‚îÇ
‚îÇ  ‚îú‚îÄ Se valida que employee_data est√© completo           ‚îÇ
‚îÇ  ‚îú‚îÄ Se genera hakenmoto_id (auto-incremental)           ‚îÇ
‚îÇ  ‚îú‚îÄ Se COPIA 40+ campos de Candidate ‚Üí Employee:        ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ Datos personales (nombre, DOB, g√©nero, etc.)    ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ Contacto (email, phone, address)                ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ Inmigraci√≥n (passport, zairyu card, visa)       ‚îÇ
‚îÇ  ‚îÇ   ‚îú‚îÄ ‚òÖ photo_data_url SE COPIA al Employee          ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ Datos de empleo (de employee_data JSON)         ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ
‚îÇ  ‚îú‚îÄ Se COPIAN documentos de Candidate ‚Üí Employee         ‚îÇ
‚îÇ  ‚îú‚îÄ Candidate.status ‚Üí HIRED (Êé°Áî®Ê∏à)                    ‚îÇ
‚îÇ  ‚îú‚îÄ Request.status ‚Üí COMPLETED (Ê∏à)                      ‚îÇ
‚îÇ  ‚îú‚îÄ Se registra en Audit Trail                           ‚îÇ
‚îÇ  ‚îî‚îÄ Se env√≠a notificaci√≥n (email/LINE)                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  FASE 4: TIPO DE EMPLEADO                               ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ¬øQu√© tipo de empleado se cre√≥?                         ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ Ê¥æÈÅ£Á§æÂì° (HAKEN SHAIN) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ Tabla: employees                                   ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ Tiene workplace, region, department              ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ Tiene yukyu (ÊúâÁµ¶‰ºëÊöá)                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ Tiene visa alerts                               ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ Tiene contracts (Â•ëÁ¥ÑÁÆ°ÁêÜ)                       ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ El cliente da instrucciones de trabajo           ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ Se cobra por hora al cliente (billing_rate)     ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ Ë´ãË≤† (UKEOI) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ Tabla: contract_workers                            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ Solo hereda campos base (EmployeeBaseMixin)     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ NO tiene workplace, region ni yukyu avanzado     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ ‚òÖ La supervisi√≥n es INTERNA (nuestra empresa)  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ ‚òÖ El cliente NO da instrucciones directas      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ ‚òÖ Si el cliente supervisa ‚Üí ÂÅΩË£ÖË´ãË≤† (ILEGAL)  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ Se cobra por proyecto/resultado                 ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ „Çπ„Çø„ÉÉ„Éï (STAFF) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Tabla: staff                                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ Personal interno de oficina                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îú‚îÄ Salario mensual fijo (no por hora)            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ No se asigna a f√°bricas externas              ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  FASE 5: GESTI√ìN DEL EMPLEADO ACTIVO                    ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  Una vez creado, el empleado:                            ‚îÇ
‚îÇ  ‚îú‚îÄ Puede ser asignado a diferentes f√°bricas            ‚îÇ
‚îÇ  ‚îú‚îÄ Se le gestionan visas y documentos con alertas      ‚îÇ
‚îÇ  ‚îú‚îÄ Puede solicitar ÊúâÁµ¶‰ºëÊöá (vacaciones pagadas)       ‚îÇ
‚îÇ  ‚îú‚îÄ Puede solicitar ‰∏ÄÊôÇÂ∏∞ÂõΩ (retorno temporal)         ‚îÇ
‚îÇ  ‚îú‚îÄ Puede solicitar ÈÄÄÁ§æ (renuncia)                     ‚îÇ
‚îÇ  ‚îú‚îÄ Se le generan contratos (PDF con firma digital)     ‚îÇ
‚îÇ  ‚îî‚îÄ Se le rastrea en el audit trail                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## SISTEMA DE FOTOS ‚Äî ESPECIFICACI√ìN COMPLETA

### Requisitos de Foto para Rirekisho Japon√©s

```
- Tama√±o est√°ndar: Á∏¶4cm √ó Ê®™3cm (vertical 4cm √ó horizontal 3cm)
- Aspecto ratio: 4:3 (vertical)
- Fondo: blanco, azul claro, o liso
- Desde el pecho hacia arriba (ËÉ∏„Åã„Çâ‰∏ä)
- Tomada en los √∫ltimos 3 meses
- Resoluci√≥n m√≠nima: 600√ó800 pixels
- Formato: JPEG
- Almacenamiento: Base64 data URL en campo photo_data_url
```

### Flujo de Fotos

```
1. UPLOAD en Candidato
   ‚îî‚Üí El usuario sube foto original (cualquier formato)
   ‚îî‚Üí Se muestra herramienta de crop interactivo (react-easy-crop)
   ‚îî‚Üí Aspect ratio forzado: 3:4 (ancho:alto)
   ‚îî‚Üí Se convierte a Base64 data URL
   ‚îî‚Üí Se almacena en candidate.photo_data_url

2. TRANSFERENCIA: Candidate ‚Üí Employee
   ‚îî‚Üí Al aprobar ÂÖ•Á§æÈÄ£Áµ°Á•®, la foto se COPIA (no referencia)
   ‚îî‚Üí employee.photo_data_url = candidate.photo_data_url
   ‚îî‚Üí Son copias independientes (cambiar una no afecta la otra)

3. TRANSFERENCIA: Candidate ‚Üí ContractWorker
   ‚îî‚Üí Mismo mecanismo que Employee

4. TRANSFERENCIA: Candidate ‚Üí Staff
   ‚îî‚Üí Mismo mecanismo

5. DISPLAY
   ‚îî‚Üí En listados: thumbnail (generado en frontend)
   ‚îî‚Üí En detalle: tama√±o completo
   ‚îî‚Üí En impresi√≥n: 3cm√ó4cm

6. OCR DE FOTOS
   ‚îî‚Üí Cuando se escanea un rirekisho con OCR
   ‚îî‚Üí Se detecta la zona de la foto
   ‚îî‚Üí Se extrae y almacena como photo_data_url
   ‚îî‚Üí Face detection disponible para validaci√≥n
```

### API de Fotos

```
GET  /api/candidates/madre/photos/{entity_type}/{entity_id}
PUT  /api/candidates/madre/photos/{entity_type}/{entity_id}

entity_type: "candidate" | "haken" | "ukeoi" | "staff"

La foto se env√≠a/recibe como Base64 data URL:
"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
```

---

## OCR E INTELIGENCIA ARTIFICIAL

### Servicio de OCR H√≠brido

```
backend/app/services/hybrid_ocr_service.py

Proveedores OCR (con fallback autom√°tico):
1. Azure Computer Vision ‚Äî Proveedor principal
2. Gemini Vision ‚Äî Backup via AI Gateway
3. OpenAI Vision ‚Äî Backup secundario

Flujo:
1. Se sube imagen del rirekisho (foto o escaneo)
2. Azure CV extrae texto crudo con coordenadas
3. AI interpreta los campos del rirekisho:
   - Mapea texto a los 50+ campos del modelo Candidate
   - Maneja diferentes formatos de rirekisho
   - Procesa kanji, hiragana, katakana, romaji
4. Se presenta vista previa para que el usuario corrija
5. Se almacena resultado en CandidateForm.form_data
6. Se crea/actualiza Candidate con datos procesados
```

### AI Gateway

```
backend/app/services/ai_gateway.py

Multi-proveedor con circuit breaker:
‚îú‚îÄ‚îÄ Gemini (Google) ‚Äî Proveedor por defecto
‚îú‚îÄ‚îÄ OpenAI ‚Äî Alternativa
‚îú‚îÄ‚îÄ Claude (Anthropic) ‚Äî Alternativa
‚îî‚îÄ‚îÄ Local CLI ‚Äî Fallback local

Usos:
- Procesamiento de rirekisho por OCR
- Interpretaci√≥n de campos japoneses
- Generaci√≥n de c√≥digo
- Asistencia general AI
```

### Face Detection

```
backend/app/services/face_detection_service.py

- Detecta si la foto tiene un rostro v√°lido
- Valida formato 3x4cm para rirekisho japon√©s
- Rechaza fotos sin rostro visible
```

---

## SISTEMA DE PERMISOS (RBAC)

### Jerarqu√≠a de Roles

```
SUPER_ADMIN (ÂÖ®Ê®©Èôê)
    ‚îî‚îÄ ADMIN (ÁÆ°ÁêÜËÄÖ)
        ‚îú‚îÄ KEITOSAN (ÁµåÁêÜÁÆ°ÁêÜ - Finanzas)
        ‚îú‚îÄ TANTOSHA (ÊãÖÂΩìËÄÖ - HR/Operaciones)
        ‚îî‚îÄ COORDINATOR („Ç≥„Éº„Éá„Ç£„Éç„Éº„Çø„Éº)
            ‚îî‚îÄ KANRININSHA (ÁÆ°ÁêÜ‰∫∫ËÄÖ - Personal de oficina)
                ‚îî‚îÄ EMPLOYEE (Ê¥æÈÅ£Á§æÂì° - Trabajador despachado)
                    ‚îî‚îÄ CONTRACT_WORKER (Ë´ãË≤† - Trabajador por contrato)
```

### Control de Acceso

```
1. Page Visibility (PageVisibility)
   - Control de qu√© p√°ginas est√°n habilitadas/bajo construcci√≥n
   - Se desactivan mostrando "„Åì„ÅÆ„Éö„Éº„Ç∏„ÅØÊ∫ñÂÇô‰∏≠„Åß„Åô" (Under Construction)

2. Role Page Permissions (RolePagePermission)
   - Cada rol puede ver/no ver cada p√°gina
   - ADMIN ve todo
   - EMPLOYEE solo ve su perfil y solicitudes
   - KEITOSAN ve m√≥dulos financieros

3. Frontend Guards
   - use-page-permission.ts ‚Üí Verifica acceso por rol
   - use-cached-page-permission.ts ‚Üí Cache para rendimiento
   - use-page-visibility.ts ‚Üí Verifica si p√°gina est√° habilitada

4. Backend Guards
   - auth_service.require_role("admin") ‚Üí Decorador de endpoints
   - auth_service.get_current_active_user ‚Üí Middleware JWT
```

---

## SISTEMA DE AUDITOR√çA

```
Dos tablas de auditor√≠a:

1. AuditLog (General)
   - Rastrea: user_id, action, table_name, record_id
   - Almacena: old_values, new_values (JSON)
   - Incluye: ip_address, user_agent

2. AdminAuditLog (Administraci√≥n)
   - Rastrea: cambios de permisos, configuraci√≥n, operaciones bulk
   - action_type: PAGE_VISIBILITY_CHANGE, ROLE_PERMISSION_CHANGE, etc.
   - resource_type: PAGE, ROLE, SYSTEM, USER, PERMISSION
   - Incluye: previous_value, new_value, description

Eventos auditados:
‚îú‚îÄ‚îÄ Creaci√≥n/modificaci√≥n de candidatos
‚îú‚îÄ‚îÄ Aprobaci√≥n/rechazo de candidatos
‚îú‚îÄ‚îÄ Creaci√≥n de empleados (ÂÖ•Á§æÈÄ£Áµ°Á•®)
‚îú‚îÄ‚îÄ Cambios de permisos de rol
‚îú‚îÄ‚îÄ Cambios de visibilidad de p√°ginas
‚îú‚îÄ‚îÄ Operaciones de importaci√≥n/exportaci√≥n
‚îú‚îÄ‚îÄ Acciones de login/logout
‚îî‚îÄ‚îÄ Cambios de configuraci√≥n del sistema
```

---

## IMPORTACI√ìN Y EXPORTACI√ìN

### Importaci√≥n Masiva

```
POST /api/import-export/import

Formatos soportados: CSV (UTF-8 BOM), Excel (.xlsx)

Proceso:
1. Upload del archivo
2. Detecci√≥n autom√°tica de columnas japonesas
3. Mapeo de columnas ‚Üí campos del modelo
4. Validaci√≥n con resumen de errores
5. Importaci√≥n con barra de progreso
6. Reporte de resultados (creados/actualizados/errores)

Importaci√≥n resiliente (/api/resilient-import/):
- Circuit breaker para prevenir cascadas de errores
- Checkpoints para recovery
- Idempotency guard para evitar duplicados
- Retry con backoff exponencial
```

### Exportaci√≥n

```
GET /api/import-export/export

Formatos: CSV, Excel, JSON
Entidades: candidates, employees, contract_workers, factories
Filtros: por status, fecha, f√°brica, etc.
```

---

## P√ÅGINAS Y VISTAS DE LA APLICACI√ìN

### Frontend (Next.js App Router)

```
/login ‚Äî P√°gina de login (JWT + CSRF)

/dashboard ‚Äî Dashboard principal con estad√≠sticas
‚îú‚îÄ‚îÄ /dashboard/candidates ‚Äî Lista y gesti√≥n de candidatos
‚îú‚îÄ‚îÄ /dashboard/employees ‚Äî Lista y gesti√≥n de empleados (Ê¥æÈÅ£Á§æÂì°)
‚îú‚îÄ‚îÄ /dashboard/factories ‚Äî Lista y gesti√≥n de f√°bricas/empresas
‚îÇ
‚îú‚îÄ‚îÄ /dashboard/yukyu ‚Äî Gesti√≥n de vacaciones pagadas (ÊúâÁµ¶‰ºëÊöá)
‚îú‚îÄ‚îÄ /dashboard/yukyu-requests ‚Äî Solicitudes de vacaciones
‚îú‚îÄ‚îÄ /dashboard/yukyu-history ‚Äî Historial de vacaciones
‚îú‚îÄ‚îÄ /dashboard/yukyu-reports ‚Äî Reportes de vacaciones
‚îÇ
‚îú‚îÄ‚îÄ /dashboard/requests ‚Äî Gesti√≥n de solicitudes (NYUUSHA, TAISHA, etc.)
‚îÇ
‚îú‚îÄ‚îÄ /dashboard/reports ‚Äî Generaci√≥n de reportes
‚îú‚îÄ‚îÄ /dashboard/admin ‚Äî Panel de administraci√≥n
‚îú‚îÄ‚îÄ /dashboard/database-management ‚Äî Operaciones de BD
‚îú‚îÄ‚îÄ /dashboard/monitoring ‚Äî Monitoreo del sistema
‚îú‚îÄ‚îÄ /dashboard/settings ‚Äî Configuraci√≥n de usuario
‚îú‚îÄ‚îÄ /dashboard/profile ‚Äî Perfil de usuario
‚îú‚îÄ‚îÄ /dashboard/themes ‚Äî Personalizaci√≥n de tema
‚îú‚îÄ‚îÄ /dashboard/design-system ‚Äî Referencia del design system
‚îú‚îÄ‚îÄ /dashboard/help ‚Äî Documentaci√≥n de ayuda
‚îú‚îÄ‚îÄ /dashboard/privacy ‚Äî Configuraci√≥n de privacidad
‚îî‚îÄ‚îÄ /dashboard/terms ‚Äî T√©rminos de servicio
```

---

## ENDPOINTS API PRINCIPALES

### Autenticaci√≥n

```
POST /api/auth/login ‚Äî Login (devuelve JWT + CSRF cookie)
GET  /api/auth/me ‚Äî Usuario actual
POST /api/auth/refresh ‚Äî Refresh token
POST /api/auth/logout ‚Äî Logout
```

### Candidatos

```
GET    /api/candidates/ ‚Äî Listar candidatos
POST   /api/candidates/ ‚Äî Crear candidato
GET    /api/candidates/{id} ‚Äî Obtener candidato
PUT    /api/candidates/{id} ‚Äî Actualizar candidato
DELETE /api/candidates/{id} ‚Äî Eliminar candidato (soft delete)
POST   /api/candidates/forms ‚Äî Guardar formulario crudo (OCR)
```

### Empleados

```
GET    /api/employees/ ‚Äî Listar empleados
POST   /api/employees/ ‚Äî Crear empleado (desde candidato aprobado)
GET    /api/employees/{id} ‚Äî Obtener empleado
PUT    /api/employees/{id} ‚Äî Actualizar empleado
DELETE /api/employees/{id} ‚Äî Eliminar empleado (soft delete)
```

### Requests (Solicitudes)

```
GET    /api/requests/ ‚Äî Listar solicitudes
POST   /api/requests/ ‚Äî Crear solicitud
GET    /api/requests/{id} ‚Äî Obtener solicitud
PUT    /api/requests/{id} ‚Äî Actualizar solicitud
POST   /api/requests/{id}/review ‚Äî Aprobar/rechazar
POST   /api/requests/{id}/approve ‚Äî Aprobar (shortcut)
POST   /api/requests/{id}/reject ‚Äî Rechazar (shortcut)
DELETE /api/requests/{id} ‚Äî Eliminar solicitud

‚òÖ ÂÖ•Á§æÈÄ£Áµ°Á•® Endpoints:
PUT    /api/requests/{id}/employee-data ‚Äî Llenar datos de empleo
POST   /api/requests/{id}/approve-nyuusha ‚Äî Aprobar y crear empleado
```

### F√°bricas

```
GET    /api/factories/ ‚Äî Listar f√°bricas
POST   /api/factories/ ‚Äî Crear f√°brica
GET    /api/factories/{id} ‚Äî Obtener f√°brica
PUT    /api/factories/{id} ‚Äî Actualizar f√°brica
DELETE /api/factories/{id} ‚Äî Eliminar f√°brica
```

### AI & OCR

```
POST /api/ai-agents/process ‚Äî Procesar con IA
POST /api/azure-ocr/scan ‚Äî Escanear documento con Azure OCR
GET  /api/ai-agents/usage ‚Äî Uso de AI por usuario
```

### Admin & Sistema

```
GET/PUT /api/pages/visibility ‚Äî Control de visibilidad de p√°ginas
GET/PUT /api/role-permissions ‚Äî Gesti√≥n de permisos por rol
GET     /api/audit/ ‚Äî Logs de auditor√≠a
GET     /api/monitoring/ ‚Äî Estado del sistema
GET     /api/settings/ ‚Äî Configuraci√≥n del sistema
```

---

## FUNCIONALIDADES CLAVE A IMPLEMENTAR

### 1. B√∫squeda Avanzada Japonesa

```
- B√∫squeda por nombre (kanji, furigana, romaji simult√°nea)
- Filtro por status (pending, approved, rejected, hired)
- Filtro por factory/empresa
- Filtro por nacionalidad
- Filtro por tipo de visa
- Full-text search con pg_trgm para japon√©s
- Ordenamiento por fecha, nombre, ID
```

### 2. Alertas Autom√°ticas

```
- Visa por vencer (30, 14, 7 d√≠as antes)
- Pasaporte por vencer
- Licencia de conducir por vencer
- Candidatos pendientes > 7 d√≠as sin revisar
- Contratos por vencer
```

### 3. Importaci√≥n OCR Inteligente

```
- Escanear rirekisho en papel ‚Üí datos estructurados
- Detecci√≥n autom√°tica de idioma (JP/EN)
- Correcci√≥n asistida por IA
- Face detection para validar foto
- Vista previa antes de confirmar
```

### 4. Generaci√≥n de Documentos

```
- PDF de rirekisho formato japon√©s (A4)
- PDF de contrato laboral
- Exportaci√≥n CSV/Excel de listas
- Reportes de auditor√≠a
```

### 5. Notificaciones

```
- Email (SMTP)
- LINE Messaging API
- Notificaciones in-app (toast)
```

---

## COMPARACI√ìN CON PROMPT_RIREKISHO_APP.md

### Diferencias Principales

| Aspecto | PROMPT_RIREKISHO_APP.md | Esta App (UNS-ClaudeJP) |
|---------|------------------------|-------------------------|
| **Stack** | Next.js API Routes o Django, Prisma, NextAuth | FastAPI + Next.js separados, SQLAlchemy, JWT propio |
| **Modelo Rirekisho** | Modelo separado con relaciones 1:N (education, work, qualifications) | **Modelo plano**: todos los campos en una tabla `candidates` (50+ columnas) |
| **Rirekisho ‚Üí Candidate** | Son modelos separados. Rirekisho se importa a Candidate | **Son la misma tabla**. Candidate = Rirekisho |
| **Fotos** | 3 versiones: original, cropped, thumbnail en filesystem | **Base64 data URL** en campo de texto (photo_data_url) |
| **HakenshainAssignment** | Modelo separado con 40+ campos de contrato y compliance | **Employee** table directa con EmployeeBaseMixin |
| **UkeoiAssignment** | Modelo separado vinculado a projects | **ContractWorker** table con mismos campos base |
| **SkillSheet** | Modelo separado anonimizado para clientes | **No implementado** (oportunidad de mejora) |
| **ÂÖ•Á§æ Workflow** | No detallado expl√≠citamente | **Workflow completo** con 3 pasos: candidato aprobado ‚Üí employee_data ‚Üí approve-nyuusha |
| **Compliance Legal** | Muy detallado: ÁÆ°ÁêÜÂè∞Â∏≥, ÊäµËß¶Êó• (3 a√±os), Art.37, Art.42 | **No implementado** (oportunidad de mejora) |
| **Familia** | No detallado | **5 miembros** con name, relation, age, residence, dependent |
| **Experiencia laboral** | WorkHistory como modelo separado con detalles | **Checkboxes** de experiencia + texto libre |
| **Info f√≠sica** | No incluido | **Muy detallado**: height, weight, blood_type, vision, shoe_size, etc. |
| **Idiomas** | japanese_level simple | **Detallado**: reading, writing, speaking, JLPT, listening, cada script |
| **Bento/Lunch** | No incluido | **Incluido**: 4 opciones de bento |
| **OCR** | No incluido | **Azure OCR + AI Gateway** multi-proveedor |
| **DB Mother** | No incluido | **UNS-DBUNIX** integration con fallback |
| **RBAC** | 4 roles simples | **8 roles** con jerarqu√≠a y page visibility |
| **Auditor√≠a** | Activity log simple | **Doble audit trail** (general + admin) |
| **Resilience** | No incluido | **Circuit breakers, retry, idempotency, checkpoints** |

### ¬øQu√© tiene PROMPT_RIREKISHO_APP que esta app NO tiene?

1. **SkillSheet** anonimizado („Çπ„Ç≠„É´„Ç∑„Éº„Éà) ‚Äî Documento para enviar a clientes sin datos personales
2. **Compliance legal detallado** ‚Äî Ê¥æÈÅ£ÂÖÉÁÆ°ÁêÜÂè∞Â∏≥, ÊäµËß¶Êó• (3 a√±os), ÂÅΩË£ÖË´ãË≤† checks
3. **Job Orders / Matching** ‚Äî Sistema de posiciones abiertas y matching candidato-posici√≥n
4. **Historial educativo y laboral** como modelos separados con detalle
5. **Generaci√≥n de PDF** formato rirekisho japon√©s est√°ndar (A3 ‚Üí A4)
6. **Validaci√≥n de c√≥digo postal** con auto-fill de direcci√≥n (zipcloud API)
7. **Conversi√≥n de era japonesa** (ÂíåÊö¶ ‚Üî Ë•øÊö¶) como utilidad
8. **Renovaci√≥n de contratos** como modelo separado

### ¬øQu√© tiene esta app que PROMPT_RIREKISHO_APP NO tiene?

1. **OCR + AI Processing** ‚Äî Escaneo autom√°tico de rirekisho
2. **Face Detection** ‚Äî Validaci√≥n de fotos
3. **Info f√≠sica detallada** ‚Äî height, weight, shoe_size, blood_type, vision, etc.
4. **Bento/Lunch options** ‚Äî Preferencias de comida
5. **8 roles** con jerarqu√≠a vs 4 roles simples
6. **Doble audit trail** ‚Äî General + Admin
7. **Resilience patterns** ‚Äî Circuit breaker, retry, idempotency
8. **OpenTelemetry** ‚Äî Telemetr√≠a y tracing distribuido
9. **BD Mother integration** ‚Äî Sincronizaci√≥n con base de datos externa
10. **ÂÖ•Á§æÈÄ£Áµ°Á•® workflow** ‚Äî Proceso detallado de 3 pasos

---

## RECOMENDACIONES PARA LA NUEVA APP

Para construir una app **mejor que ambas**, combinar lo mejor de cada una:

### De PROMPT_RIREKISHO_APP.md, tomar:
- [ ] Modelos separados para EducationHistory, WorkHistory, Qualification (m√°s flexible que campos planos)
- [ ] SkillSheet anonimizado (requerido por ley Âä¥ÂÉçËÄÖÊ¥æÈÅ£Ê≥ï26Êù°7È†Ö)
- [ ] Compliance legal: ÁÆ°ÁêÜÂè∞Â∏≥, ÊäµËß¶Êó•, ÂÅΩË£ÖË´ãË≤† checks
- [ ] Job Orders y sistema de Matching
- [ ] Generaci√≥n PDF formato rirekisho japon√©s
- [ ] Validaci√≥n de „Äí postal code con auto-fill
- [ ] Conversi√≥n ÂíåÊö¶ (era japonesa)
- [ ] Renovaci√≥n de contratos como modelo separado

### De UNS-ClaudeJP, tomar:
- [ ] OCR + AI multi-proveedor con fallback
- [ ] Face Detection para fotos
- [ ] ÂÖ•Á§æÈÄ£Áµ°Á•® workflow (3 pasos)
- [ ] Info f√≠sica detallada y preferencias de bento
- [ ] RBAC con 8 roles jer√°rquicos
- [ ] Doble audit trail
- [ ] Resilience patterns (circuit breaker, retry, idempotency)
- [ ] OpenTelemetry observability
- [ ] Sync con BD externa

### Mejoras adicionales sugeridas:
- [ ] **Rirekisho como modelo separado** con versioning (candidato puede tener m√∫ltiples rirekisho)
- [ ] **Notificaciones real-time** (WebSocket) adem√°s de email/LINE
- [ ] **Calendar view** para visualizar disponibilidad de trabajadores
- [ ] **Mobile-first** responsive design
- [ ] **i18n completo** (Êó•Êú¨Ë™û/English/Espa√±ol) con next-intl
- [ ] **Generaci√≥n autom√°tica de contratos** con plantillas PDF
- [ ] **Dashboard KPIs** (tasa de contrataci√≥n, tiempo promedio de proceso, etc.)
- [ ] **API versioning** para compatibilidad forward

---

## INSTRUCCIONES PARA LA IA QUE CONSTRUYA LA APP

### Fase 1: Setup del Proyecto
```
1. Crear proyecto con Next.js 16+ (App Router) + TypeScript + Tailwind + shadcn/ui
2. Crear backend con FastAPI + SQLAlchemy + Alembic
3. Configurar PostgreSQL con encoding UTF-8 + locale ja_JP
4. Configurar Docker Compose con todos los servicios
5. Implementar autenticaci√≥n JWT + CSRF
6. Crear layout base con sidebar navigation
```

### Fase 2: Modelos y Base de Datos
```
1. Definir todos los modelos (User, Candidate, Employee, ContractWorker, etc.)
2. Crear Rirekisho como modelo separado con relaciones 1:N
3. Crear modelos de EducationHistory, WorkHistory, Qualification
4. Implementar EmployeeBaseMixin para campos compartidos
5. Crear migraciones con Alembic
6. Seed data para desarrollo
```

### Fase 3: Rirekisho + Candidatos
```
1. Formulario completo de rirekisho (50+ campos)
2. Upload y crop de foto (3x4cm japon√©s)
3. OCR con Azure Computer Vision + AI Gateway
4. Importaci√≥n masiva CSV/Excel
5. Vista de listado con b√∫squeda avanzada japonesa
6. Detalle del candidato con tabs
```

### Fase 4: Workflow de Contrataci√≥n
```
1. Revisi√≥n y entrevista (thumbs up/down)
2. Aprobaci√≥n/rechazo de candidatos
3. ÂÖ•Á§æÈÄ£Áµ°Á•® (3 pasos: crear ‚Üí llenar datos ‚Üí aprobar)
4. Creaci√≥n autom√°tica de Employee/ContractWorker/Staff
5. Copia de foto y documentos
6. Audit trail completo
```

### Fase 5: Gesti√≥n de Empleados
```
1. CRUD completo de empleados (haken + ukeoi + staff)
2. Asignaci√≥n a f√°bricas/empresas
3. Gesti√≥n de contratos
4. Sistema de solicitudes (yukyu, taisha, ikkikokoku)
5. Alertas de visa y documentos
6. RBAC con 8 roles
```

### Fase 6: Funcionalidades Transversales
```
1. Dashboard con estad√≠sticas y KPIs
2. Reportes y exportaci√≥n (CSV, Excel, PDF)
3. Notificaciones (email, LINE, in-app)
4. Observability (OpenTelemetry, Grafana, Prometheus)
5. Resilience patterns (circuit breaker, retry)
6. Compliance legal (ÁÆ°ÁêÜÂè∞Â∏≥, ÊäµËß¶Êó•)
```

---

## NOTAS T√âCNICAS IMPORTANTES

### Soporte de Caracteres Japoneses
```
- PostgreSQL: encoding UTF8, LC_COLLATE=ja_JP.UTF-8
- Backend: all strings UTF-8, Pydantic models with proper validation
- Frontend: lang="ja" in HTML, fuentes japonesas (Noto Sans JP)
- CSV import: detectar BOM UTF-8 autom√°ticamente
- PDF: embeber fuentes japonesas
- B√∫squeda: pg_trgm para similitud en kana/kanji
```

### Seguridad
```
- JWT tokens (HS256) con expiraci√≥n de 8 horas
- CSRF protection (Double-Submit Cookie Pattern)
- Passwords: BCrypt hash
- Datos sensibles: encriptados (AES-256) en BD
  (passport, bank account, „Éû„Ç§„Éä„É≥„Éê„Éº, etc.)
- Rate limiting por usuario y endpoint
- CORS configurado para dominio espec√≠fico
- Input validation en frontend (Zod) y backend (Pydantic)
- Security audit logging (login attempts, permission changes)
- bandit scan para vulnerabilidades en c√≥digo Python
```

### Conversi√≥n ÂíåÊö¶ (Era Japonesa)
```typescript
function toWareki(date: Date): string {
  const year = date.getFullYear();
  if (year >= 2019) return `‰ª§Âíå${year - 2018}Âπ¥`;
  if (year >= 1989) return `Âπ≥Êàê${year - 1988}Âπ¥`;
  if (year >= 1926) return `Êò≠Âíå${year - 1925}Âπ¥`;
  if (year >= 1912) return `Â§ßÊ≠£${year - 1911}Âπ¥`;
  return `ÊòéÊ≤ª${year - 1867}Âπ¥`;
}
```

---

**FIN DEL PROMPT ‚Äî Este documento contiene la especificaci√≥n completa para construir una aplicaci√≥n de gesti√≥n HR para empresa de staffing japonesa, combinando lo mejor de dos sistemas existentes y a√±adiendo mejoras. Incluye: modelos de datos detallados, flujo de trabajo completo candidato‚Üíempleado, gesti√≥n de fotos, OCR, RBAC con 8 roles, doble audit trail, resilience patterns, y compliance legal japon√©s.**
